{
  "version": 3,
  "sources": ["../../bmaplib.curveline/index.js"],
  "sourcesContent": ["(function (root, factory) {  \n  if (typeof exports === 'object') {  \n      module.exports = factory();\n  } else if (typeof define === 'function' && define.amd) {  \n      define(factory);  \n  } else {\n      root.BMapLib = root.BMapLib || {};\n      root.BMapLib.CurveLine = root.BMapLib.CurveLine || factory();  \n  }  \n})(this, function() {\n  function CurveLine(points, opts) {\n    try {\n      BMap;\n    } catch (e) {\n      throw Error('Baidu Map JS API is not ready yet!');\n    }\n    var self = this;\n    var curvePoints = getCurvePoints(points);\n    var polyline = new BMap.Polyline(curvePoints, opts);\n\n    polyline.addEventListener('lineupdate', function(){\n      if (this.isEditing) {\n        this.enableEditing();\n      }\n    });\n\n    polyline.cornerPoints = points;\n    polyline.editMarkers = []; //缂栬緫鍔熻兘鐨勯《鐐�\n\n    /**\n     * 閲嶅啓寮х嚎鐨勭紪杈戝姛鑳�\n     */\n    polyline.enableEditing = function () {\n      var self = this;\n\n      if (self.map) {\n        self.disableEditing();\n        for (var i = 0; i < self.cornerPoints.length; i++) {\n          var marker = new BMap.Marker(self.cornerPoints[i], {\n            icon: new BMap.Icon('http://api.map.baidu.com/library/CurveLine/1.5/src/circle.png', new BMap.Size(16,16)),\n            enableDragging: true,\n            raiseOnDrag: true\n          });\n          marker.addEventListener('dragend', function(){\n            self.cornerPoints.length = 0;\n            for (var i = 0; i < self.editMarkers.length; i++) {\n              self.cornerPoints.push(self.editMarkers[i].getPosition());\n            }\n            var curvePoints = getCurvePoints(self.cornerPoints)\n            self.setPath(curvePoints);\n          });\n          marker.index = i;\n          self.editMarkers.push(marker);\n          self.map.addOverlay(marker);\n        }\n      }\n      self.isEditing = true;\n    }\n\n    /**\n     * 閲嶅啓寮х嚎鐨勭紪杈戝姛鑳�\n     */\n    polyline.disableEditing = function() {\n      this.isEditing = false;\n      //娓呯┖涔嬪墠鐨勭紪杈戠偣\n      for (var i = 0; i < this.editMarkers.length; i++) {\n        this.map.removeOverlay(this.editMarkers[i]);\n        this.editMarkers[i] = null;\n      }\n      this.editMarkers.length = 0;\n    }\n\n    /**\n     * 鑾峰彇寮х嚎鐨勫潗鏍囩偣\n     */\n    polyline.getPath = function() {\n      return curvePoints;\n    }\n\n    // polyline.points = points; //寮х嚎鐨勫潗鏍囬《鐐�\n    // polyline.enableEditing = enableEditing;\n    // polyline.disableEditing = disableEditing;\n    // polyline.getPath = getPath;\n    return polyline;\n  }\n\n  function extend(child, parent) {\n    for (var p in parent) {\n      if (parent.hasOwnProperty(p)) {\n        child[p] = parent[p];\n      }\n    }\n    \n    return child;\n  };\n\n  function getCurvePoints(points) {\n    var curvePoints = [];\n    for (var i = 0; i < points.length - 1; i++) {\n      var p = getCurveByTwoPoints(points[i], points[i + 1]);\n      if (p && p.length > 0) {\n        curvePoints = curvePoints.concat(p);\n      }\n    }\n    return curvePoints;\n  }\n\n  function getCurveByTwoPoints(obj1, obj2) {\n    var curveCoordinates = [];\n    if (!obj1 || !obj2 || !(obj1 instanceof BMap.Point) || !(obj2 instanceof BMap.Point)) {\n      return null;\n    }\n\n    var B1 = function(x) {\n      return 1 - 2 * x + x * x;\n    };\n    var B2 = function(x) {\n      return 2 * x - 2 * x * x;\n    };\n    var B3 = function(x) {\n      return x * x;\n    };\n\n    var count=30; // 鏇茬嚎鏄敱涓€浜涘皬鐨勭嚎娈电粍鎴愮殑锛岃繖涓〃绀鸿繖涓洸绾挎墍鏈夊埌鐨勬姌绾跨殑涓暟\n    var isFuture=false;\n    var t, h, h2, lat3, lng3, j, t2;\n    var LnArray = [];\n    var i = 0;\n    var inc = 0;\n\n    if (typeof(obj2) == \"undefined\") {\n      if (typeof(curveCoordinates) != \"undefined\") {\n        curveCoordinates = [];\n      }\n      return;\n    }\n\n    var lat1 = parseFloat(obj1.lat);\n    var lat2 = parseFloat(obj2.lat);\n    var lng1 = parseFloat(obj1.lng);\n    var lng2 = parseFloat(obj2.lng);\n      \n    // 璁＄畻鏇茬嚎瑙掑害鐨勬柟娉�\n    if (lng2 > lng1) {\n      if (parseFloat(lng2-lng1) > 180) {\n        if (lng1 < 0) {\n          lng1 = parseFloat(180 + 180 + lng1);\n        }\n      }\n    }\n    \n    if (lng1 > lng2) {\n      if (parseFloat(lng1-lng2) > 180) {\n        if (lng2 < 0) {\n          lng2 = parseFloat(180 + 180 + lng2);\n        }\n      }\n    }\n    j = 0;\n    t2 = 0;\n    if (lat2 == lat1) {\n      t = 0;\n      h = lng1 - lng2;\n    } else if (lng2 == lng1) {\n      t = Math.PI / 2;\n      h = lat1 - lat2;\n    } else {\n      t = Math.atan((lat2 - lat1) / (lng2 - lng1));\n      h = (lat2 - lat1) / Math.sin(t);\n    }\n    if (t2 == 0) {\n      t2 = (t + (Math.PI / 5));\n    }\n    h2 = h / 2;\n    lng3 = h2 * Math.cos(t2) + lng1;\n    lat3 = h2 * Math.sin(t2) + lat1;\n\n    for (i = 0; i < count + 1; i++) {\n      curveCoordinates.push(new BMap.Point(\n        (lng1 * B1(inc) + lng3 * B2(inc)) + lng2 * B3(inc),\n        (lat1 * B1(inc) + lat3 * B2(inc) + lat2 * B3(inc))\n      ));\n      inc = inc + (1 / count);\n    }\n    return curveCoordinates;\n  }\n  return CurveLine;\n});\n"],
  "mappings": "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",
  "names": ["self", "i", "curvePoints"]
}
